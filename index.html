<html ng-app="myApp">
    <head>
        <title>Crasponline Studio</title>
        
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <script src="js/jquery.js"></script>
        <script src="js/jquery.bridget.js"></script>
        <script src="js/get-style-property.js"></script>
        <script src="js/get-size.js"></script>
        <script src="js/EventEmitter.js"></script>
        <script src="js/eventie.js"></script>
        <script src="js/doc-ready.js"></script>
        <script src="js/matches-selector.js"></script>
        <script src="js/item.js"></script>
        <script src="js/outlayer.js"></script>
        <script src="js/imagesloaded.js"></script>
        <script src="js/plugins.min.js"></script>
        <script src='js/masonry.pkgd.min.js'></script>
        <script src="js/showdown.min.js"></script>

        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular-resource.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.8/angular-route.min.js"></script>
        <script src="https://cdn.firebase.com/js/client/2.0.4/firebase.js"></script>
        <script src="https://cdn.firebase.com/libs/angularfire/0.9.1/angularfire.min.js"></script>
        <script src="js/angular-sanitize.min.js"></script>
        <script src="js/markdown.js"></script>
        <script src='js/angular-masonry.js'></script>
        <script src="js/ngLoading.js"></script>
        
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/login.css">
        <link rel="stylesheet" href="css/masonry.css">
        <link rel="stylesheet" href="css/ngLoading.css">
        <link href='http://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="https://www.firebase.com/resources/tutorial/css/example.css">

<!-- CACHE FILE: videos.html -->
<script type="text/ng-template" id="videos.html">
    <!-- Header -->
    <header class="cabecalho">
        <h1 class="title title-int"><span>Crasp</span><br><em>online</em></h1>
    </header>

    <!-- Categorias -->
    <div class="navbar categories">
        <nav>
            <ul class="cat bar">
                <li><a ng-click="filters.category = ''">TODOS</a></li>
                <li><a ng-click="filters.category = '1'">Musica</a></li>
                <li><a ng-click="filters.category = '2'">Cine</a></li>
                <li><a ng-click="filters.category = '3'">Publicidad</a></li>
            </ul>

            <select>
                <option ng-click="filters.category = ''">TODOS</option>
                <option ng-click="filters.category = '1'">Musica</option>
                <option ng-click="filters.category = '2'">Cine</option>
                <option ng-click="filters.category = '3'">Publicidad</option>
            </select>
        </nav>
    </div>
        
    <div class="row projetos" masonry>
        <div class="masonry-brick item p" ng-repeat="video in videos | reverse | filter:filters">
            <a href="#/video/{{ video.uri }}" title>
                <img ng-src="{{ video.thumbnail }}" alt="A masonry brick">
                <div class="info">
                    <div class="t">
                        <div class="tc">
                            <h3>{{ video.title }}</h3>
                            <p>{{ video.epigram }}</p>
                        </div>
                    </div>
                </div>
            </a>
        </div>
    </div>
    
</script>

<!-- CACHE FILE: video.html -->
<script type="text/ng-template" id="video.html">

    <div ng-show="notfound">
        <!-- Header -->
        <header class="cabecalho">
            <h1 class="title title-int"><span>404</span><br><em>not found</em></h1>
        </header>
    </div>
    
    <div ng-show="video">
        <!-- Header -->
        <header class="cabecalho">
            <h1 class="title title-int"><span>{{video.title}}</span><br><em>{{video.epigram}}</em></h1>
        </header>
        
        <!-- Conteúdo -->
        <section>
            <!-- Descrição -->
            <h2>{{video.description}}</h2>

            <!-- Vimeo -->
            <div class="fotos">
                <div class="fluid-width-video-wrapper">
                    <iframe ng-src="{{vimeo_url}}" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>
                </div>

            <!-- Ficha Técnica -->
            <aside>
                <h4>Notes</h4>
                <div btf-markdown="video.notes"></div>
            </aside>
            </div>
        </section>

        <!-- Nav -->
        <div class="lowernav">
            <nav class="nav-proj">
                <ul>
                    <li><a href="#/video/{{next_video.uri}}"><span>{{next_video.title}}</span><br><em>{{next_video.epigram}}</em></a></li>
                    <li class="bar"><a href="#">TODOS</a></li>
                    <li><a href="#/video/{{prev_video.uri}}"><span>{{prev_video.title}}</span><br><em>{{prev_video.epigram}}</em></a></li>
                </ul>
            </nav>
        </div>
        
    </div>

</script>

<!-- CACHE FILE: acerca.html -->
<script type="text/ng-template" id="acerca.html">
    <!-- Header -->
    <header class="cabecalho">
        <h1 class="title title-int"><span>Acerca</span><br><em>del Craspo</em></h1>
    </header>
</script>

<!-- CACHE FILE: donde.html -->
<script type="text/ng-template" id="donde.html">
    <!-- Header -->
    <header class="cabecalho">
        <h1 class="title title-int"><span>Donde</span><br><em>lo encontramos</em></h1>
    </header>
</script>

<!-- CACHE FILE: login.html -->
<script type="text/ng-template" id="login.html">
    <!-- Header -->
    <header class="cabecalho">
        <h1 class="title title-int"><span>Admin</span><br><em>Login</em></h1>
    </header>
    
    <form class="form-login" role="form" ng-submit="submit()" autocomplete="on">
        <h2 class="form-login-heading">Please login</h2>
        <input ng-model="email" name="email" type="email" class="form-control" placeholder="Email address" required autofocus/>
        <input ng-model="password" name="password" type="password" class="form-control" placeholder="Password" required/>
        <div class="checkbox">
            <label>
                <input ng-model="remember" type="checkbox" value="remember-me" class="checkbox-label" checked="True" /> Remember me
            </label>
        </div>
        <button class="btn btn-lg btn-primary btn-block" type="submit">
            <span class="glyphicon glyphicon-log-in"></span> Login
        </button>
    </form>
    
    <div class="alert alert-danger" role="alert" ng-show="err">{{ err }}</div>

</script>

<!-- CACHE FILE: admin.html -->
<script type="text/ng-template" id="admin.html">
    <!-- Header -->
    <header class="cabecalho">
        <h1 class="title title-int"><span>Admin</span><br><em>Area</em></h1>
    </header>

    <div ng-show="user">
        <p>
            <em>{{ user.password.email }}</em>
            <a ng-click="logout()" class="btn btn-sm btn-default"><span class="glyphicon glyphicon-log-out"></span> Logout</a>
        </p>
    </div>
    
    <table class="table table-striped">
        <thead>
            <th class="name">Video</th>
            <th>&nbsp;</th>
            <th>
                <a href="#/add"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span></a>
            </th>
        </thead>
        <tbody>
            <tr ng-repeat="(id, vid) in video | reverse">
                <td>
                    <a href="#/video/{{ vid.uri }}">
                        {{ vid.uri }}
                    </a>
                </td>
                <td>
                    <a href="#/edit/{{ vid.$id }}" class="btn btn-default btn-link">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                    </a>
                </t>
                <td>
                    <button class="btn btn-default btn-link" type="button" ng-click="remove(id)">
                        <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

</script>

<!-- CACHE FILE: detail.html -->
<script type="text/ng-template" id="detail.html">
    <!-- Header -->
    <header class="cabecalho">
        <h1 class="title title-int"><span>Video</span><br><em>edit</em></h1>
    </header>

    <form class="form-video form-horizontal" ng-submit="save()">
        
        <!-- URI -->
        <div class="form-group">
            <label for="uri" class="col-sm-2 control-label">URI</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="uri" placeholder="Friendly URL" required maxlength="64" pattern="[a-zA-Z0-9_-]+" ng-model="video.uri" ng-disabled="editing">
            </div>
        </div>
        
        <!-- Title -->
        <div class="form-group">
            <label for="title" class="col-sm-2 control-label">Title</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="title" placeholder="Title" required maxlength="16" ng-model="video.title">
            </div>
        </div>

        <!-- Epigram -->
        <div class="form-group">
            <label for="epigram" class="col-sm-2 control-label">Epigram</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="epigram" placeholder="Epigram" required maxlength="24" ng-model="video.epigram">
            </div>
        </div>
                
        <!-- Vimeo ID -->
        <div class="form-group">
            <label for="vimeoid" class="col-sm-2 control-label">Vimeo ID</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="vimeoid" placeholder="Vimeo Numeric ID" required ng-model="video.vimeoid" ng-keyup="fetchData()">
            </div>
        </div>
        
        <!-- Thumbnail -->
        <div class="form-group">
            <label for="thumbnail" class="col-sm-2 control-label">Thumbnail</label>
            <div class="col-sm-10">
                <input type="url" class="form-control" id="thumbnail" placeholder="Thumbnail URL" required ng-model="video.thumbnail">
            </div>
        </div>
        
        <!-- Description -->
        <div class="form-group">
            <label for="description" class="col-sm-2 control-label">Description</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="description" placeholder="Description" required ng-model="video.description">
            </div>
        </div>
        
        <!-- Notes -->
        <div class="form-group">
            <label for="notes" class="col-sm-2 control-label">Notes</label>
            <div class="col-sm-10">
                <textarea class="form-control" rows="6" id="notes" ng-model="video.notes"></textarea>
            </div>
        </div>

        <!-- Categories -->
        <div class="form-group">
            <label for="category" class="col-sm-2 control-label">Category</label>
            <div class="col-sm-10">
                <select class="form-control" ng-model="video.category" ng-options="cat.id as cat.name for cat in categories"></select>
            </div>
        </div>
        
        <!-- Buttons -->
        <div class="form-group">
            <a href="#/admin" class="btn btn-default" role="button">
                <span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Cancelar
            </a>
            <button type="submit" class="btn btn-primary">
                <span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span> Guardar
            </button>
        </div>
        
    </form>
    
    <div class="alert alert-danger" role="alert" ng-show="err">{{ err }}</div>

</script>

    </head>
    
    <body class="int">
        
        <article class="margem">
        
            <!-- Header -->
            <header class="cabecalho">

                <!-- Logo -->
                <h1 class="logo"><a href="#login" title="El Craspo">Crasponline Studio • Fotografia y Video</a></h1>

                <!-- Menu -->
                <ul class="menu bar">
                    <li><a href="#videos" title="Videos">Videos</a></li>
                    <li><a href="#acerca" title="Acerca">Acerca</a></li>
                    <li><a href="#donde" title="Donde">Donde</a></li>
                </ul>

                <!-- Social -->
                <ul class="social">
                    <li><a href="http://fb.me/cras" title="Facebook" target="_blank">Facebook</a></li>
                    <li><a href="http://vimeo.com/po" title="Vimeo" target="_blank">Vimeo</a></li>
                    <li><a href="http://instagram.com/online" title="Instagram" target="_blank">Instagram</a></li>
                </ul>
            </header>
        
            <section>
            
                <!-- Laterais -->
                <ul class="lateral">
                    <li>VIDEOS</li>
                    <li>BIEN PIOLAS</li>
                </ul>

                <div ng-view></div>
                
            </section>
            
            <!-- Footer -->
            <footer class="bar">
                12 3456 7890&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;
                <a href="#">baws@crasponline.com.ar</a>&nbsp;&nbsp;&nbsp;/&nbsp;&nbsp;&nbsp;
                <a href="#admin">admin</a>
            </footer>
            
        </article>

<script>
myApp = angular.module('myApp', ['ngRoute','firebase', 'wu.masonry', 'ngLoading', 'btford.markdown'])
.config(function($sceDelegateProvider) {
    $sceDelegateProvider.resourceUrlWhitelist([ 'self', '**' ]);
})
.config(function(loadingProvider) {
})
.value('firebaseURL', 'https://incandescent-torch-8162.firebaseio.com/')
.service('fbRef', function(firebaseURL) {
  return new Firebase(firebaseURL)
})
.service('Categories', function() {
  return [
            { id: 0, name: '' },
            { id: 1, name: 'Musica' },
            { id: 2, name: 'Cine' },
            { id: 3, name: 'Publicidad' }
        ];
})
.factory('Auth', ['$firebaseAuth', function($firebaseAuth) {
    var ref = new Firebase("https://incandescent-torch-8162.firebaseio.com/");
    return $firebaseAuth(ref);
}])
.factory('vimeoInfo', function($http){
    return {
        get: function( vimeoId ) {
            return $http.jsonp( 'http://vimeo.com/api/v2/video/' + vimeoId + '.json?callback=JSON_CALLBACK&_=' + (new Date().getTime()) );
        }
    };
})
.factory('Person', function(firebaseURL, $firebase){
    return $firebase(new Firebase(firebaseURL)).$asArray();
})
.filter('reverse', function() {
    function toArray(list) {
        var k, out = [];
        if( list ) {
            if( angular.isArray(list) ) {
                out = list;
            }
            else if( typeof(list) === 'object' ) {
                for (k in list) {
                    if (list.hasOwnProperty(k)) { out.push(list[k]); }
                }
            }
        }
        return out;
    }
    return function(items) {
        return toArray(items).slice().reverse();
    };
})
.controller('Add', ['$scope', 'Person', '$location', 'Categories', 'vimeoInfo',
    function($scope, Person, $location, Categories, vimeoInfo) {
    
        $scope.categories = Categories;
        
        $scope.editing = false;
        $scope.person = Person;

        console.log( $scope.person );
        
        $scope.save = function() {
            var save = Person.$add( $scope.video );

            if (save){
                $location.path('/admin');
            } 
        }
        
        $scope.fetchData = function() {
            vimeoInfo.get( $scope.video.vimeoid ).success( function(response){
                response.forEach(function(res){
                    $scope.video.thumbnail = res.thumbnail_large;
                    $scope.video.description = res.description;
                });
            });
        }
  
    }
])
.controller('Edit', [ '$scope', '$location', '$routeParams', '$firebase', 'firebaseURL', 'Categories', 'vimeoInfo',
    function ($scope, $location, $routeParams, $firebase, firebaseURL, Categories, vimeoInfo) {
        $scope.editing = true;
        $scope.categories = Categories;
        console.log( $routeParams );
        var personURL = new Firebase(firebaseURL + $routeParams.id);
        $scope.video = $firebase(personURL).$asObject();

        console.log( $scope.video );
        $scope.save = function() {
            $scope.video.$save();
            $location.path('/admin');
        }
        
        $scope.fetchData = function() {
            vimeoInfo.get( $scope.video.vimeoid ).success( function(response){
                console.log( response );
                response.forEach(function(res){
                    $scope.video.thumbnail = res.thumbnail_large;
                    $scope.video.description = res.description;
                });
            });
        }
    }
])
.controller('Admin', ['$scope', 'Auth', '$location', 'Person',
    function($scope, Auth, $location, Person) {
    
        $scope.auth = Auth;
        $scope.user = $scope.auth.$getAuth();
        if( ! $scope.user ) {
            $location.path('/login');
        }
        
        $scope.logout = function(){
            $scope.auth.$unauth();
            $location.path('/');
        }
        
        $scope.video = Person;
        console.log( $scope.video );
        
        $scope.remove = function (id) {
            Person.$remove(id);
        }

    }
])
.controller('Login', ['$scope', 'Auth', '$location',
    function($scope, Auth, $location) {
        $scope.auth = Auth;
        $scope.submit = function () {
            $scope.auth.$authWithPassword({
                email    : $scope.email,
                password : $scope.password
            }).then(function(authData) {
                $location.path('/admin');
            }).catch(function(error) {
                $scope.err = error.message;
            });
        }
    }
])
.controller('Acerca', ['$scope',
    function($scope) {
        $scope.greetings = "hola acerca!";
    }
])
.controller('Donde', ['$scope',
    function($scope) {
        $scope.greetings = "hola donde!";
    }
])
.controller('Videos', ['$scope', 'Person',
    function($scope, Person) {
        $scope.videos = Person;
    }
])
.controller('Video', function ($scope, Person, $routeParams ) {
    var videos = Person;
    videos.$loaded().then( function(videos) {
        videos.forEach( function( video ) {
            if ( video.uri == $routeParams.uri ) {
                $scope.video = video;
                $scope.vimeo_url = 'http://player.vimeo.com/video/' + $scope.video.vimeoid + '?api=1';
            }
        });
        if ( $scope.video ) {
            var index = videos.indexOf( $scope.video );
            $scope.prev_video = videos[ videos.indexOf( $scope.video ) - 1 ];
            $scope.next_video = videos[ videos.indexOf( $scope.video ) + 1 ];
        } else {
            $scope.notfound = ( $scope.video == null );
        }       
    });
})
.config(function($routeProvider) {
    $routeProvider
        .when('/', {
            controller:'Videos',
            templateUrl:'videos.html'
        })
        .when('/video/:uri', {
            controller: 'Video',
            templateUrl: 'video.html'
        })
        .when('/acerca', {
            controller:'Acerca',
            templateUrl:'acerca.html'
        })
        .when('/donde', {
            controller:'Donde',
            templateUrl:'donde.html'
        })
        .when('/admin', {
            controller:'Admin',
            templateUrl:'admin.html'
        })
        .when('/login', {
            controller:'Login',
            templateUrl:'login.html'
        })
        .when('/add', {
            controller: 'Add',
            templateUrl: 'detail.html'
        })
        .when('/edit/:id', {
            controller: 'Edit',
            templateUrl: 'detail.html'
        })
        .otherwise({
            redirectTo:'/'
        });
})
;
</script>
</body>

</html>